<%@ page contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>

<div class="container">
  <h2 style="text-align: center; color: var(--primary-color); margin-bottom: 2rem;">ğŸ“‚ Quáº£n lÃ½ danh má»¥c</h2>
  
  <div class="category-tabs">
    <a class="tab-btn ${type=='EXPENSE'?'active':''}" 
       href="${pageContext.request.contextPath}/categories?type=EXPENSE">
      ğŸ’¸ Danh má»¥c chi tiÃªu
    </a>
    <a class="tab-btn ${type=='INCOME'?'active':''}" 
       href="${pageContext.request.contextPath}/categories?type=INCOME">
      ğŸ’° Danh má»¥c thu nháº­p
    </a>
  </div>
  
  <div class="category-form">
    <h3 class="form-title">
      <c:choose>
        <c:when test="${type == 'EXPENSE'}">â• ThÃªm danh má»¥c chi tiÃªu má»›i</c:when>
        <c:otherwise>â• ThÃªm danh má»¥c thu nháº­p má»›i</c:otherwise>
      </c:choose>
    </h3>
    <form method="post" action="${pageContext.request.contextPath}/categories" class="form-horizontal">
      <input type="hidden" name="action" value="create">
      <input type="hidden" name="type" value="${type}">
      <div class="form-group">
        <label class="form-label">TÃªn danh má»¥c</label>
        <input type="text" name="name" class="form-control" placeholder="VÃ­ dá»¥: Ä‚n uá»‘ng, XÄƒng xe, LÆ°Æ¡ng..." required style="padding: 1rem;">
      </div>
      <div class="form-group">
        <button type="submit" class="btn btn-success" style="padding: 1rem 2rem; font-weight: 600;">
          â• ThÃªm danh má»¥c
        </button>
      </div>
    </form>
  </div>

  <div class="category-table">
    <div style="background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); color: white; padding: 1rem 1.5rem; font-weight: 600;">
      <c:choose>
        <c:when test="${type == 'EXPENSE'}">ğŸ’¸ Danh sÃ¡ch danh má»¥c chi tiÃªu</c:when>
        <c:otherwise>ğŸ’° Danh sÃ¡ch danh má»¥c thu nháº­p</c:otherwise>
      </c:choose>
    </div>
    <div class="table-container" style="border-radius: 0; border-top: none;">
      <table>
        <thead>
          <tr>
            <th>ğŸ“ TÃªn danh má»¥c</th>
            <th>ğŸ‘¤ Thuá»™c vá»</th>
            <th>âš™ï¸ Thao tÃ¡c</th>
          </tr>
        </thead>
        <tbody>
          <c:forEach var="c" items="${items}">
            <tr>
              <td>
                <c:choose>
                  <c:when test="${empty c.userId}">
                    <span style="font-weight: 700; color: var(--primary-color); font-size: 1rem;">
                      ${c.name}
                    </span>
                  </c:when>
                  <c:otherwise>
                    <form method="post" action="${pageContext.request.contextPath}/categories" style="display: flex; gap: 0.75rem; align-items: center;">
                      <input type="hidden" name="action" value="rename">
                      <input type="hidden" name="type" value="${type}">
                      <input type="hidden" name="id" value="${c.id}">
                      <input type="text" name="name" value="${c.name}" class="form-control" style="flex: 1; margin: 0; padding: 0.75rem; font-weight: 600;">
                      <button type="submit" class="btn btn-primary" style="padding: 0.75rem 1.25rem; font-weight: 600;">
                        ğŸ’¾ LÆ°u
                      </button>
                    </form>
                  </c:otherwise>
                </c:choose>
              </td>
              <td>
                <c:choose>
                  <c:when test="${empty c.userId}">
                    <span style="background: linear-gradient(135deg, var(--accent-color), var(--primary-color)); color: white; padding: 0.5rem 1rem; border-radius: var(--radius-md); font-size: 0.8rem; font-weight: 600;">
                      ğŸŒ Há»‡ thá»‘ng
                    </span>
                  </c:when>
                  <c:otherwise>
                    <span style="background: linear-gradient(135deg, var(--success-color), #059669); color: white; padding: 0.5rem 1rem; border-radius: var(--radius-md); font-size: 0.8rem; font-weight: 600;">
                      ğŸ‘¤ CÃ¡ nhÃ¢n
                    </span>
                  </c:otherwise>
                </c:choose>
              </td>
              <td>
                <c:if test="${not empty c.userId}">
                  <form method="post" action="${pageContext.request.contextPath}/categories"
                        onsubmit="return confirm('âš ï¸ Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a danh má»¥c \"${c.name}\" khÃ´ng?\n\nLÆ°u Ã½: HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c!');" style="display: inline;">
                    <input type="hidden" name="action" value="delete">
                    <input type="hidden" name="type" value="${type}">
                    <input type="hidden" name="id" value="${c.id}">
                    <button type="submit" class="btn btn-error" style="padding: 0.75rem 1.25rem; font-weight: 600;">
                      ğŸ—‘ï¸ XÃ³a
                    </button>
                  </form>
                </c:if>
                <c:if test="${empty c.userId}">
                  <span style="color: var(--text-secondary); font-style: italic; font-size: 0.875rem; font-weight: 500;">
                    ğŸ”’ KhÃ´ng thá»ƒ xÃ³a
                  </span>
                </c:if>
              </td>
            </tr>
          </c:forEach>
          <c:if test="${empty items}">
            <tr>
              <td colspan="3" style="text-align: center; color: var(--text-secondary); font-style: italic; padding: 3rem; font-size: 1.1rem;">
                ğŸ“­ ChÆ°a cÃ³ danh má»¥c nÃ o Ä‘Æ°á»£c táº¡o
              </td>
            </tr>
          </c:if>
        </tbody>
      </table>
    </div>
  </div>
</div>
