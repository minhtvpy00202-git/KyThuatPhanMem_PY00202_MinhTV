<%@ page contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>

<div class="container">
  <h2 >ğŸ“‚ Quáº£n lÃ½ danh má»¥c</h2>
  
  <div class="category-tabs">
    <a class="tab-btn ${type=='EXPENSE'?'active':''}" 
       href="${pageContext.request.contextPath}/categories?type=EXPENSE">
      ğŸ’¸ Danh má»¥c chi tiÃªu
    </a>
    <a class="tab-btn ${type=='INCOME'?'active':''}" 
       href="${pageContext.request.contextPath}/categories?type=INCOME">
      ğŸ’° Danh má»¥c thu nháº­p
    </a>
  </div>
  
  <div class="category-form">
    <h3 class="form-title">
      <c:choose>
        <c:when test="${type == 'EXPENSE'}">â• ThÃªm danh má»¥c chi tiÃªu má»›i</c:when>
        <c:otherwise>â• ThÃªm danh má»¥c thu nháº­p má»›i</c:otherwise>
      </c:choose>
    </h3>
    <form method="post" action="${pageContext.request.contextPath}/categories" class="form-horizontal">
      <input type="hidden" name="action" value="create">
      <input type="hidden" name="type" value="${type}">
      <div class="form-group">
        <label class="form-label">TÃªn danh má»¥c</label>
        <input type="text" name="name" class="form-control" placeholder="VÃ­ dá»¥: Ä‚n uá»‘ng, XÄƒng xe, LÆ°Æ¡ng..." required >
      </div>
      <div class="form-group">
        <button type="submit" class="btn btn-success" >
          â• ThÃªm danh má»¥c
        </button>
      </div>
    </form>
  </div>

  <div class="category-table">
    <div >
      <c:choose>
        <c:when test="${type == 'EXPENSE'}">ğŸ’¸ Danh sÃ¡ch danh má»¥c chi tiÃªu</c:when>
        <c:otherwise>ğŸ’° Danh sÃ¡ch danh má»¥c thu nháº­p</c:otherwise>
      </c:choose>
    </div>
    <div class="table-container" >
      <table>
        <thead>
          <tr>
            <th>ğŸ“ TÃªn danh má»¥c</th>
            <th>ğŸ‘¤ Thuá»™c vá»</th>
            <th>âš™ï¸ Thao tÃ¡c</th>
          </tr>
        </thead>
        <tbody>
          <c:forEach var="c" items="${items}">
            <tr>
              <td>
                <c:choose>
                  <c:when test="${empty c.userId}">
                    <span >
                      ${c.name}
                    </span>
                  </c:when>
                  <c:otherwise>
                    <form method="post" action="${pageContext.request.contextPath}/categories" >
                      <input type="hidden" name="action" value="rename">
                      <input type="hidden" name="type" value="${type}">
                      <input type="hidden" name="id" value="${c.id}">
                      <input type="text" name="name" value="${c.name}" class="form-control" >
                      <button type="submit" class="btn btn-primary" >
                        ğŸ’¾ LÆ°u
                      </button>
                    </form>
                  </c:otherwise>
                </c:choose>
              </td>
              <td>
                <c:choose>
                  <c:when test="${empty c.userId}">
                    <span >
                      ğŸŒ Há»‡ thá»‘ng
                    </span>
                  </c:when>
                  <c:otherwise>
                    <span >
                      ğŸ‘¤ CÃ¡ nhÃ¢n
                    </span>
                  </c:otherwise>
                </c:choose>
              </td>
              <td>
                <c:if test="${not empty c.userId}">
                  <form method="post" action="${pageContext.request.contextPath}/categories"
                        onsubmit="return confirm('âš ï¸ Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a danh má»¥c \"${c.name}\" khÃ´ng?\n\nLÆ°u Ã½: HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c!');" >
                    <input type="hidden" name="action" value="delete">
                    <input type="hidden" name="type" value="${type}">
                    <input type="hidden" name="id" value="${c.id}">
                    <button type="submit" class="btn btn-error" >
                      ğŸ—‘ï¸ XÃ³a
                    </button>
                  </form>
                </c:if>
                <c:if test="${empty c.userId}">
                  <span >
                    ğŸ”’ KhÃ´ng thá»ƒ xÃ³a
                  </span>
                </c:if>
              </td>
            </tr>
          </c:forEach>
          <c:if test="${empty items}">
            <tr>
              <td colspan="3" >
                ğŸ“­ ChÆ°a cÃ³ danh má»¥c nÃ o Ä‘Æ°á»£c táº¡o
              </td>
            </tr>
          </c:if>
        </tbody>
      </table>
    </div>
  </div>
</div>
